# ASM2VEC Utilities Documentation

## Overview

The `utils.py` file contains various utility functions and classes that support the ASM2VEC model. These utilities handle data loading, preprocessing, training, and evaluation tasks.

## Classes

### AsmDataset

A custom PyTorch Dataset for handling assembly code data. This class makes it easy to use assembly code data with PyTorch DataLoaders.

```python
class AsmDataset(Dataset):
    def __init__(self, x, y):
        self.x = x
        self.y = y
```

## Functions

### load_data

```python
def load_data(paths, limit=None):
```

Loads assembly code data from specified paths. This function reads assembly code files, processes them into `Function` objects, and extracts tokens.

- `paths`: A string or list of strings specifying file or directory paths.
- `limit`: An optional limit on the number of files to load.

Returns a tuple containing lists of functions, tokens, and the offset.

### preprocess

```python
def preprocess(functions, tokens):
```

Preprocesses the loaded functions and tokens, converting them into tensor format suitable for training the ASM2VEC model.

Returns a tuple of preprocessed input (x) and target (y) tensors.

### train

```python
def train(functions, tokens, model=None, embedding_size=100, batch_size=128, epochs=80, neg_sample_num=25, calc_acc=False, device='cpu', mode='train', callback=None, learning_rate=0.02):
```

Handles the training process for the ASM2VEC model. This function sets up the model, data loaders, and optimization process.

Key parameters:
- `functions`: List of Function objects.
- `tokens`: Tokens object containing all tokens.
- `model`: Optional pre-trained model for fine-tuning.
- `embedding_size`: Size of the embedding vectors.
- `batch_size`: Batch size for training.
- `epochs`: Number of training epochs.
- `neg_sample_num`: Number of negative samples per positive sample.
- `device`: Device to use for training ('cpu' or 'cuda').
- `mode`: Training mode ('train' or 'test').

Returns the trained ASM2VEC model.

### save_model and load_model

```python
def save_model(path, model, tokens):
def load_model(path, device='cpu'):
```

These functions handle saving and loading the ASM2VEC model and associated tokens.

### show_probs

```python
def show_probs(x, y, probs, tokens, limit=None, pretty=False):
```

Displays prediction probabilities for assembly instructions. This function is useful for visualizing and debugging model predictions.

### accuracy

```python
def accuracy(y, probs):
```

Calculates the accuracy of predictions by comparing the model's output probabilities with the true labels.

## Usage

To use these utilities in your ASM2VEC project:

1. Load your data:
   ```python
   functions, tokens, offset = load_data('path/to/your/data')
   ```

2. Preprocess the data:
   ```python
   x, y = preprocess(functions, tokens)
   ```

3. Create a dataset and data loader:
   ```python
   dataset = AsmDataset(x, y)
   dataloader = DataLoader(dataset, batch_size=32, shuffle=True)
   ```

4. Train the model:
   ```python
   model = train(functions, tokens, embedding_size=128, epochs=100)
   ```

5. Save the trained model:
   ```python
   save_model('model.pth', model, tokens)
   ```

6. Later, load the model:
   ```python
   loaded_model, loaded_tokens = load_model('model.pth')
   ```

7. Evaluate predictions:
   ```python
   show_probs(x_test, y_test, model.predict(x_test), tokens)
   ```

These utilities provide a comprehensive toolkit for working with the ASM2VEC model, from data preparation to model evaluation.
