from sisa import SISA
from subDetector import subDetector
import logging

def training(logger):
    print('Training the model...')
    logger.info('Training the model...')
    mySISA = SISA()
    mySISA.divide_data(logger)
    mySISA.preprocess(logger, purpose='train')
    mySISA.sisa_training(logger)

def prediction(logger):
    print('Predicting by the model...')
    logger.info('Predicting by the model...')
    mySISA = SISA()
    mySISA.majority_vote(logger, purpose='predict')
    mySISA.explain(logger)

def unlearning(logger):
    print('Unlearning the model...')
    logger.info('Unlearning the model...')
    mySISA = SISA()
    mySISA.machine_unlearning(logger)

def set_log():
    logger = logging.getLogger("asm2vec")
    logger.setLevel(logging.INFO)

    formatter = logging.Formatter('%(asctime)s - %(filename)s - %(levelname)s - %(message)s')
    file_handler = logging.FileHandler('./log.log', mode='w')
    file_handler.setLevel(logging.INFO)
    file_handler.setFormatter(formatter)

    stream_handler = logging.StreamHandler()
    stream_handler.setFormatter(formatter)

    logger.addHandler(file_handler)
    logger.addHandler(stream_handler)

    logger.info('Program has started')
    return logger

if __name__ == '__main__':
    
    logger = set_log()

    if subDetector().config.train:
        training(logger)
    if subDetector().config.predict:
        prediction(logger)
    if subDetector().config.unlearn:
        unlearning(logger)

    logger.info('Program has ended')
