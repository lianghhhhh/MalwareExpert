# ASM2VEC Data Types Documentation

## Overview

The `datatype.py` file defines the core data structures used in the ASM2VEC project. These classes represent various components of assembly code, from individual tokens to entire functions, and provide methods for manipulating and analyzing these structures.

## Classes

### Token

Represents a single token in the assembly code.

```python
class Token:
    def __init__(self, name, index):
        self.name = name
        self.index = index
        self.count = 1
```

Attributes:
- `name`: The string representation of the token.
- `index`: A unique identifier for the token.
- `count`: The frequency of the token in the dataset.

### Tokens

Manages a collection of `Token` objects, acting as a vocabulary for the assembly code.

```python
class Tokens:
    def __init__(self, name_to_index=None, tokens=None):
        self.name_to_index = name_to_index or {}
        self.tokens = tokens or []
        self._weights = None
```

Key methods:
- `add(names)`: Adds new tokens to the collection.
- `update(tokens_new)`: Updates the token collection with new tokens.
- `weights()`: Calculates sampling weights based on token frequencies.
- `sample(batch_size, num=5)`: Samples tokens based on their weights.

### Function

Represents a function in assembly code, containing instructions, basic blocks, and metadata.

```python
class Function:
    def __init__(self, insts, blocks, meta):
        self.insts = insts
        self.blocks = blocks
        self.meta = meta
```

Key methods:
- `load(text)`: Class method to parse assembly code and construct a `Function` object.
- `tokens()`: Returns all tokens in the function's instructions.
- `random_walk(num=3)`: Performs random walks through the function's control flow graph.

### BasicBlock

Represents a basic block in the control flow graph of a function.

```python
class BasicBlock:
    def __init__(self):
        self.insts = []
        self.successors = set()
```

Methods:
- `add(inst)`: Adds an instruction to the basic block.
- `end()`: Checks if the basic block ends with a jump or return instruction.

### Instruction

Represents a single assembly instruction.

```python
class Instruction:
    def __init__(self, op, args):
        self.op = op
        self.args = args
```

Key methods:
- `load(text)`: Class method to parse a single line of assembly code into an `Instruction` object.
- `tokens()`: Returns the tokens (opcode and arguments) of the instruction.
- `is_jmp()`: Checks if the instruction is a jump instruction.
- `is_call()`: Checks if the instruction is a call instruction.

## Usage

These data types form the foundation of the ASM2VEC project. Here's how you might use them:

1. Parsing assembly code:
   ```python
   with open('assembly_file.s', 'r') as f:
       function = Function.load(f.read())
   ```

2. Working with tokens:
   ```python
   tokens = Tokens()
   tokens.add(function.tokens())
   ```

3. Analyzing instructions:
   ```python
   for inst in function.insts:
       if inst.is_call():
           print(f"Found call instruction: {inst}")
   ```

4. Performing random walks:
   ```python
   for walk in function.random_walk(num=5):
       print("Random walk through function:")
       for inst in walk:
           print(inst)
   ```

These data types provide a rich set of tools for working with assembly code in the context of the ASM2VEC project. They allow for easy parsing, analysis, and manipulation of assembly code structures, which is essential for the embedding process and subsequent tasks.
