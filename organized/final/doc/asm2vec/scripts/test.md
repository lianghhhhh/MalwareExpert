# ASM2VEC Test Module Documentation

## Overview

The `test.py` module in the ASM2VEC project provides functionality for inference and embedding extraction using a pre-trained ASM2VEC model. This module is primarily used for testing and evaluating the model on new assembly code data.

## Main Function: cli

```python
def cli(ipath, mpath, epochs=30, neg_sample_num=25, device='auto', lr=0.02, pretty=False, limit=None):
```

This function performs ASM2VEC inference and embedding extraction.

### Parameters

- `ipath` (str): Path to the input assembly data.
- `mpath` (str): Path to the pre-trained model.
- `epochs` (int, optional): Number of fine-tuning epochs. Default is 30.
- `neg_sample_num` (int, optional): Number of negative samples for training. Default is 25.
- `device` (str, optional): Device to use for computation ('auto', 'cuda', or 'cpu'). Default is 'auto'.
- `lr` (float, optional): Learning rate for fine-tuning. Default is 0.02.
- `pretty` (bool, optional): Whether to use pretty formatting for output. Default is False.
- `limit` (int, optional): Limit on the number of samples to process. Default is None.

### Returns

- `tuple`: Contains the offset and the extracted embedding.

### Functionality

1. Determines the appropriate device (CPU or CUDA) for computation.
2. Loads the pre-trained model and tokens.
3. Loads and processes the new assembly data.
4. Updates the model's vocabulary if necessary.
5. Fine-tunes the model on the new data.
6. Extracts the final embedding for the input file.

### Usage Example

```python
from asm2vec.package import test

offset, embedding = test.cli(
    ipath='path/to/new/assembly/data',
    mpath='path/to/pretrained/model',
    epochs=50,
    device='cuda'
)

print(f"Offset: {offset}")
print(f"Embedding shape: {embedding.shape}")
```

## Note

This module is particularly useful for extracting embeddings from new assembly code using a pre-trained ASM2VEC model. The extracted embeddings can be used for various downstream tasks such as similarity comparison, classification, or anomaly detection in assembly code analysis.
