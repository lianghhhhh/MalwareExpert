# ASM2VEC Train Module Documentation

## Overview

The `train.py` module in the ASM2VEC project provides functionality for training or fine-tuning the ASM2VEC model. This module handles the entire training process, including data loading, model initialization or loading, and the training loop.

## Main Function: cli

```python
def cli(ipath, opath, mpath, limit, embedding_size=100, batch_size=128, epochs=30, neg_sample_num=25, calc_acc=False, device='auto', lr=0.02):
```

This function manages the ASM2VEC model training or fine-tuning process.

### Parameters

- `ipath` (str): Path to the input assembly data.
- `opath` (str): Path to save the trained model.
- `mpath` (str): Path to a pre-trained model (if fine-tuning).
- `limit` (int): Limit on the number of samples to process.
- `embedding_size` (int, optional): Size of the embedding vectors. Default is 100.
- `batch_size` (int, optional): Batch size for training. Default is 128.
- `epochs` (int, optional): Number of training epochs. Default is 30.
- `neg_sample_num` (int, optional): Number of negative samples for training. Default is 25.
- `calc_acc` (bool, optional): Whether to calculate accuracy during training. Default is False.
- `device` (str, optional): Device to use for computation ('auto', 'cuda', or 'cpu'). Default is 'auto'.
- `lr` (float, optional): Learning rate for training. Default is 0.02.

### Functionality

1. Determines the appropriate device (CPU or CUDA) for computation.
2. Loads a pre-trained model if `mpath` is provided, otherwise initializes a new model.
3. Loads and processes the assembly data.
4. Updates the model's vocabulary if necessary.
5. Defines a callback function for logging training progress and saving the model.
6. Trains the model using the utility functions from the `utils` module.

### Callback Function

The `callback` function is defined within `cli` to handle logging and model saving during training:

```python
def callback(context):
    """
    Callback function for logging training progress and saving the model.

    Args:
        context (dict): Dictionary containing training context information.
    """
    # ... (implementation details)
```

This callback prints training progress (epoch, time, loss, and optionally accuracy) and saves the model after each epoch.

### Usage Example

```python
from asm2vec.package import train

train.cli(
    ipath='path/to/assembly/data',
    opath='path/to/save/model',
    mpath=None,  # Set to None for training from scratch
    limit=1000,
    embedding_size=128,
    epochs=50,
    device='cuda'
)
```

## Note

This module is the core component for training the ASM2VEC model. It can be used both for training a new model from scratch and for fine-tuning an existing model on new data. The trained model is saved periodically, allowing for resumption of training if interrupted.
