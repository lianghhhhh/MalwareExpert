# MalwareExpert
**implement paper:**\
**- malware detector: <https://ieeexplore.ieee.org/document/10145856>**\
**- SISA training: <https://arxiv.org/abs/1912.03817>**\
**The project isn't finished yet; I'm still editing.**
## Environment
1. create a conda environment for this project
```git
conda create --name [env name] python=3.11.5
conda activate [env name]
```
2. install the requirements
```git
pip install -r requirements.txt
```
## SAFE
**reference: <https://github.com/facebookresearch/SAFEtorch>**
- download SAFE model:
```git
wget http://dl.fbaipublicfiles.com/SAFEtorch/model.tar.gz
tar -xzvf model.tar.gz
rm model.tar.gz
```

## asm2vec
**reference: <https://github.com/oalieno/asm2vec-pytorch>**
- train your own asm2vec model:
1. change the epoch & batch_size in config.json to meet your needs
2. go to the folder for training asm2vec model
```git
cd src/asm2vec/scripts/
```
3. extract the features
```git
python bin2asm.py [path of config.json]
```
4. start training
```git
python train.py [path of config.json]
```

## Run the code
1. change config.json to your desired types
2. run the main file
```python
python main.py [path of config.json]
```

## Input
**config.json**
| name | usage |
| :-- | :-- |
| word2id | the path of word2id.json |
| SAFEtorch | the path of SAFEtorch.pt |
| asm2vec_model | the path of asm2vec model |
| label | the path of the label of the data set |
| record | the path to store the record of the training data |
| score | the path to store the score of the models |
| result | the path to store the result of predictions |
| log | the path to store the log file |
| dataset | the path of the dataset folder |
| embedding | the folder to store the embeddings |
| feature | the folder to store the features |
| vectorize | the folder to store the vectorize files |
| model | the folder to store models |
| predict | the folder of data for prediction |
| unlearn | the folder of data for unlearning |
| explain | the folder to store the explained data after prediction |
| epoch | how much epoch to train in a slice |
| learning_rate | the learning rate when training |
| batch_size | the batch size when training |
| hidden_dim | the hidden dimension |
| shard_count | divide into how many shards |
| slice_count | divide into how many slices |
| dropout_value | the dropout value while training gnn model |
| output_dim | the final output dimension of gnn model (must be 2 here) |
| softmax_dim | the dimension of softmax |
| preprocess_method | choose between "asm2vec" and "SAFE" |
| train | do the training process |
| predict | do the prediction |
| unlearn | unlearn some data after training |

## Output
**log.log**
- print out the progress while the program is running

**record.json**
- record the data's name, the purpose of the data (train or test), where the data is in the models, and has the data be unlearned or not
  
**predict_result.json**
- the name of the predicted data and its detection result
  
**score.json**
- the accuracy, precision, recall, and f1 score after SISA training & unlearning, also records the training and validation loss in every epoch of each model
